# Work Process in This Boilerplate

## Introduction

본 문서는 이 보일러플레이트(템플릿)를 활용한 백엔드 개발 프로세스에 대해서 설명합니다.

다음과 같은 준비가 완료되었다고 가정합니다.

1. Docker로 `postgres` 컨테이너가 배포됨.
2. `.env` 환경설정을 완료함.
3. `yarn start:dev` 명령어로 서버와 데이터베이스가 연동됨을 확인함.

## SDK

### API 인터페이스 정의

가장 먼저, SDK를 통해 Frontend에 전달할 도메인/인터페이스를 작성해야 합니다.

예시로, 아래 경로의 파일을 확인합니다.

```bash
./sdk/api/user/user.api.ts
```

해당 경로의 파일은 `User` 도메인에서 API 인터페이스를 정의합니다.

1. `User` 도메인을 구현하는 백엔드의 Controller 또는 프론트엔드의 Service 등을 나타냅니다.
2. `User` 도메인에서 이용할 수 있는 시그니처 메소드(Method)들을 선언합니다.
3. 각 메소드에서 이용되는 입/출력 인터페이스를 정의합니다.

모델 선언이 필요한 경우, `user.domain.ts` 파일에서 선언합니다. 여기서 이야기하는 모델은 엔티티(Entity)에서 도출되어 서비스에서 주로 다루는 도메인 모델을 의미합니다.

### API 속성 정의

다음으로, 해당 API 인터페이스에 따라 `User` 도메인에서 백엔드 Controller가 가지는 엔드포인트 속성을 정의합니다.

아래 경로의 파일을 확인합니다.

```bash
./sdk/api/user/user.route.ts
```

해당 경로의 파일에서 하나의 시그니처 메소드를 보면 아래와 같은 정보를 확인할 수 있습니다.

1. 해당 메소드가 호출되는 HTTP Method (ex. GET, POST, etc.)
2. 해당 메소드가 호출되는 Route 경로(Path)
3. 해당 메소드를 호출할 수 있는 권한 정의
4. 추가로 Swagger에 노출할 설명(Description)

여기까지 작성했다면, 프론트엔드로 SDK를 전달할 수 있으며, 백엔드에서는 구현 작업을 시작할 수 있습니다.

구현된 인터페이스를 SDK로 배포하려면 루트 디렉토리에서 아래 명령어를 이용합니다.

```bash
$ yarn sdk
```

## SRC

백엔드의 실제 구현은 `src` 경로에서 진행됩니다.

각 디렉토리 경로는 다음 구현부를 가집니다.

-   `common` : NestJS 서버에서 자주 재사용되는 기능들을 구현합니다.
-   `config` : 서버에서 이용하는 환경변수 설정들을 적용합니다.
-   `infrastructure` : 서버에서 연결하는 외부 서비스(모듈)를 구현합니다.
-   `module` : 서버의 기능들을 구현합니다.

### Controller

컨트롤러 기능은 앞서 정의한 API 인터페이스에 따라 프론트엔드와이 소통 방식을 구현합니다.

아래 경로의 파일을 확인합니다.

```bash
./src/module/user/user.controller.ts
```

컨트롤러에서는 앞서 구현한 API 인터페이스를 import 하여, 실제 호출부를 구현하면 됩니다.

NestJS에서 기본적으로 제공하는 데코레이터를 Wrapping한 `@Route` 데코레이터를 이용하여, 각 호출 메소드를 정의하는 `Route` 값들을 넣어주고, 시그니처 메소드를 연결하여 구현합니다.

예를 들어, 아래와 같이 구현 가능합니다.

```typescript
@Route.Get(UserRoute.getUserInfoById, {
    summary: "Get public information of user by ID.",
    success: {
        message: SUCCESS_MESSAGE.USER.FOUND,
        description: "Returns public information of user.",
        dataGenericType: UserInfoDto,
    },
    errors: ["USER_NOT_FOUND"],
})
async getUserInfoById(
    @Param() params: UserIdParamsDto
): Promise<SuccessResponseDto<UserInfoDto>> {
    const result = await this.userService.getUserInfoById(params);
    return asSuccessResponse(SUCCESS_MESSAGE.USER.FOUND, result);
}
```

-   `@Route.Get` 은 GET 메소드를 이용하는 API임을 나타냅니다.
-   `@Route.Get` 의 첫번째 인자는 해당 시그니처 메소드의 정보를 지정합니다.
-   두번째 인자는 Swagger에 명시할 요약, 성공 타입, 에러타입 등을 명시합니다.
-   메소드의 입력값은 상황에 따라, `@Query`, `@Param`, `@Body` 등 기존 NestJS 데코레이터를 이용합니다.
-   `SuccessResponseDto` 에 해당하는 공통 타입으로 감싼 응답 값을 주도록 합니다.
